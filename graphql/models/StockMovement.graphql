"Enregistrement d'un mouvement de stock pour un ingrédient ou une préparation"
type StockMovement {
    "Identifiant unique."
    id: ID!

    "Entité concernée par le mouvement (ingrédient ou préparation)"
    trackable: StockMovementTrackable! @morphTo

    "Emplacement où s'est produit le mouvement"
    location: Location! @belongsTo

    "Entreprise associée"
    company: Company! @belongsTo

    "Utilisateur qui a effectué l'opération"
    user: User @belongsTo

    "Type de mouvement (addition ou withdrawal)"
    type: String!

    "Quantité concernée par le mouvement"
    quantity: Float!

    "Quantité avant le mouvement"
    quantity_before: Float!

    "Quantité après le mouvement"
    quantity_after: Float!

    "Date de création du mouvement"
    created_at: DateTime!

    "Date de mise à jour"
    updated_at: DateTime!
}

"Entité pouvant être suivie dans les mouvements de stock"
union StockMovementTrackable = Ingredient | Preparation

extend type Query @guard {
    "Liste des mouvements de stock pour l'entreprise actuelle"
    stockMovements(
        "Filtre par type de mouvement (addition ou withdrawal)"
        type: String @eq

        "Filtre par emplacement"
        locationId: ID @where(key: "location_id")

        "Filtre par date de début"
        startDate: DateTime @where(key: "created_at", operator: ">=")

        "Filtre par date de fin"
        endDate: DateTime @where(key: "created_at", operator: "<=")

        "Options de tri"
        orderBy: [StockMovementOrderByClause!] @orderBy
    ): [StockMovement!]! @paginate(defaultCount: 20, scopes: ["forCompany"])

    "Trouve un mouvement de stock spécifique"
    stockMovement(id: ID! @eq): StockMovement @find(scopes: ["forCompany"])

    "Mouvements de stock pour un ingrédient spécifique"
    ingredientStockMovements(
        ingredientId: ID! @where(key: "trackable_id")
        locationId: ID @where(key: "location_id")
    ): [StockMovement!]!
        @paginate(
            defaultCount: 20
            builder: "App\\GraphQL\\Builders\\StockMovementBuilder@forIngredient"
        )

    "Mouvements de stock pour une préparation spécifique"
    preparationStockMovements(
        preparationId: ID! @where(key: "trackable_id")
        locationId: ID @where(key: "location_id")
    ): [StockMovement!]!
        @paginate(
            defaultCount: 20
            builder: "App\\GraphQL\\Builders\\StockMovementBuilder@forPreparation"
        )
}

"Options de tri pour les mouvements de stock"
input StockMovementOrderByClause {
    "Champ sur lequel effectuer le tri"
    field: StockMovementOrderByField!

    "Direction du tri"
    order: SortOrder!
}

"Champs disponibles pour le tri des mouvements de stock"
enum StockMovementOrderByField {
    CREATED_AT @enum(value: "created_at")
    QUANTITY @enum(value: "quantity")
    TYPE @enum(value: "type")
}
